generator client {
  provider = "prisma-client-js"
  output   = "../generated/client"
}

datasource db {
  provider = "postgresql"
  //url      = env("NX_DATABASE_URL_POSTGRESQL")
}

model Role {
  id   Int    @id @default(autoincrement())
  name String @unique @db.VarChar(50)

  userRole    UserRole[]
  permissions BigInt     @default(0)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model User {
  id         Int     @id @default(autoincrement())
  avatar_url String?
  email      String  @unique

  address Address[]

  is_verified Boolean @default(false)
  is_locked   Boolean @default(false)

  password String
  username String? @db.VarChar(50)
  bio      String? @db.VarChar(150)



  userRole UserRole[]
  shop     Shop[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([email])
}

model UserRole {
  id   Int  @id @default(autoincrement())
  user User @relation(fields: [userId], references: [id])
  role Role @relation(fields: [roleId], references: [id])

  userId Int
  roleId Int

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId])
  @@index([roleId])
}

model Shop {
  id          Int     @id @default(autoincrement())
  name        String
  description String?
  logo_url    String?
  cover_url   String?
  is_active   Boolean @default(true)

  user   User @relation(fields: [userId], references: [id])
  userId Int  @unique

  products Product[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId])
}

model Category {
  id Int @id @default(autoincrement())

  name String @unique @db.VarChar(50)

  products Product[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Address {
  id Int @id @default(autoincrement())
  street String
  district String 
  isDefault Boolean @default(false)

  user User @relation(fields: [userId], references: [id])
  userId Int

  city City @relation(fields: [cityId], references: [id])
  cityId Int

  country Country @relation(fields: [countryId], references: [id])
  countryId Int

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model City {
  id Int @id @default(autoincrement())

  name String @unique @db.VarChar(50)

  address Address[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
}

model Country {
  id Int @id @default(autoincrement())

  name String @unique @db.VarChar(50)

  address Address[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
 
}

model Product {
  id          String   @id @default(uuid())
  name        String
  basePrice   Decimal  @db.Decimal(12, 2)
  stock       Int      @default(0)
  discount    Int      @default(0)

  shopId      Int
  shop        Shop     @relation(fields: [shopId], references: [id])
  categoryId  Int
  category    Category @relation(fields: [categoryId], references: [id])

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([name])
}
